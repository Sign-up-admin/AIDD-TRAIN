# COMPASS微服务启动指南

## 环境要求

- **COMPASS服务环境**: `AIDDTRAIN` (C:\ProgramData\Anaconda3\envs\AIDDTRAIN)
- **FLASH-DOCK环境**: `flash_dock`
- **依赖已安装**: FastAPI, Uvicorn, python-multipart, requests, httpx

## 启动方式

### 方式一：使用批处理脚本（推荐）

直接双击运行 `start_all_services.bat`，它会自动打开三个窗口：
1. 服务注册中心窗口
2. COMPASS服务窗口
3. FLASH-DOCK窗口

### 方式二：手动启动（三个独立窗口）

#### 1. 启动服务注册中心

打开第一个命令提示符窗口：
```cmd
conda activate AIDDTRAIN
cd E:\Qinchaojun\AIDD-TRAIN
python services/registry/server.py --host 0.0.0.0 --port 8500
```

等待看到：`Service Registry started`

#### 2. 启动COMPASS服务

打开第二个命令提示符窗口：
```cmd
conda activate AIDDTRAIN
cd E:\Qinchaojun\AIDD-TRAIN
python compass/service_main.py --host 0.0.0.0 --port 8080 --registry-url http://localhost:8500
```

等待看到：`COMPASS Service started` 和 `Registered with service registry`

#### 3. 启动FLASH-DOCK

打开第三个命令提示符窗口：
```cmd
conda activate flash_dock
cd E:\Qinchaojun\AIDD-TRAIN\FLASH_DOCK-main
streamlit run FlashDock.py --server.port 8501
```

等待浏览器自动打开或手动访问：http://localhost:8501

## 验证服务状态

### 检查服务注册中心
- 浏览器访问：http://localhost:8500
- 或访问：http://localhost:8500/docs (API文档)

### 检查COMPASS服务
- 浏览器访问：http://localhost:8080
- 或访问：http://localhost:8080/docs (API文档)
- 健康检查：http://localhost:8080/health

### 检查FLASH-DOCK
- 浏览器访问：http://localhost:8501

## 服务端口

- **服务注册中心**: 8500
- **COMPASS服务**: 8080
- **FLASH-DOCK**: 8501

## 故障排除

### 1. 端口被占用
如果某个端口被占用，可以修改端口：
- 服务注册中心：`--port 8501`（或其他端口）
- COMPASS服务：`--port 8081`（或其他端口）
- FLASH-DOCK：`--server.port 8502`（或其他端口）

**注意**：修改端口后，需要更新COMPASS服务的注册URL：
```cmd
python compass/service_main.py --port 8081 --registry-url http://localhost:8501
```

### 2. 导入错误
确保在项目根目录 (`E:\Qinchaojun\AIDD-TRAIN`) 运行命令。

### 3. 服务无法连接
- 检查防火墙设置
- 确保所有服务都在运行
- 检查日志输出中的错误信息

### 4. COMPASS服务未注册
- 确保服务注册中心先启动
- 检查注册中心URL是否正确
- 查看COMPASS服务窗口的错误信息

## 使用说明

启动后，在FLASH-DOCK界面中：

1. **预测亲和力** - 选择"预测亲和力"页面，可以选择COMPASS或PLANET模型
2. **训练管理** - 创建和管理训练任务
3. **数据管理** - 上传和管理数据集
4. **服务监控** - 查看服务状态和可用模型

## 停止服务

在每个服务窗口中按 `Ctrl+C` 停止服务。

或使用任务管理器结束Python进程。

