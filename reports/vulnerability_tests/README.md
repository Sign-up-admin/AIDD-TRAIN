# 训练管理漏洞自动化测试

## 概述

这个测试脚本使用Chrome自动化（Playwright）来发现训练管理中的漏洞，特别是"启动训练后无法停止"的问题。

## 功能特性

1. **创建训练任务测试** - 测试任务创建流程
2. **启动训练任务测试** - 测试任务启动流程
3. **停止训练任务测试** - 重点测试停止功能
4. **状态同步测试** - 验证UI状态与实际状态的一致性
5. **快速停止测试** - 测试启动后立即停止
6. **多次停止点击测试** - 测试多次点击停止按钮
7. **漏洞检测** - 自动检测和记录各种漏洞
8. **详细报告** - 生成包含截图和日志的测试报告

## 使用方法

### 前置要求

1. 安装Python依赖：
```bash
pip install playwright requests
playwright install chromium
```

2. 确保所有服务已启动：
   - 服务注册中心 (localhost:8500)
   - COMPASS服务 (localhost:8080)
   - Streamlit应用 (localhost:8501)

### 运行测试

```bash
python test_training_vulnerabilities.py
```

### 测试选项

- `headless=False`: 显示浏览器窗口（默认）
- `headless=True`: 无头模式运行

## 测试场景

### 场景1: 基础启动停止测试
- 创建训练任务
- 启动训练任务
- 等待任务进入running状态
- 尝试停止任务
- 验证任务状态变化

### 场景2: 快速停止测试
- 启动任务后立即尝试停止
- 验证是否能够立即停止

### 场景3: 多次停止测试
- 启动任务
- 多次点击停止按钮
- 验证是否出现错误或异常

### 场景4: 状态同步测试
- 启动任务
- 停止任务
- 刷新页面
- 验证状态是否同步

## 漏洞检测

测试脚本会自动检测以下漏洞：

1. **VULN-001**: 停止按钮不可见
2. **VULN-002**: 停止按钮不可见（DOM中存在但不可见）
3. **VULN-003**: 停止按钮不可点击
4. **VULN-004**: 停止操作失败
5. **VULN-005**: 停止操作无响应
6. **VULN-006**: UI状态与API状态不一致
7. **VULN-007**: 快速停止失败
8. **VULN-008**: 多次点击停止按钮导致错误
9. **VULN-009**: 状态同步失败

## 测试报告

测试完成后，会在 `reports/vulnerability_tests/` 目录下生成：

1. **vulnerability_report.md** - 详细的测试报告
2. **screenshots/** - 所有测试截图
3. **logs/** - 测试日志（如有）

### 报告内容

- 测试概览
- 测试结果详情
- 发现的漏洞列表
- 每个漏洞的详细信息：
  - 严重程度
  - 描述
  - 复现步骤
  - 期望行为 vs 实际行为
  - 截图和日志

## 注意事项

1. 测试需要所有服务正常运行
2. 测试会创建实际的训练任务
3. 测试可能需要较长时间（取决于任务执行时间）
4. 测试过程中浏览器窗口会保持打开
5. 测试完成后服务不会自动停止，需要手动停止

## 故障排除

### 服务未启动
- 检查服务是否正在运行
- 检查端口是否被占用
- 查看服务日志

### 测试失败
- 查看测试报告中的错误信息
- 检查截图以了解失败原因
- 查看控制台输出

### 任务ID提取失败
- 检查任务是否成功创建
- 查看页面内容
- 尝试手动提取任务ID

## 扩展测试

可以轻松扩展测试脚本以添加更多测试场景：

1. 添加新的测试方法
2. 在 `run_all_tests()` 中调用新方法
3. 添加新的漏洞检测逻辑

## 贡献

欢迎提交问题和改进建议。



